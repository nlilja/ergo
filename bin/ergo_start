#!/usr/bin/python
# -*- coding: utf-8 -*-


"""
ERGO
Launcher
"""


import sys

from ergo import init, show_error, show_help, ErgoError, ErgoThread


def main(argv = []):
    """
    Launcher.
    """
    
    # Initialize
    try:
        init(argv)
    except ErgoError, error:
        if error.message:
            return show_error(error.message)
        else:
            return show_help("ergo_start")
    
    # Start threads
    threads = []
    
    for account in config["ao"]["accounts"]:
        ergo = ErgoThread(
            username  = account["username"],
            password  = account["password"],
            host      = account["dimension"]["host"],
            port      = account["dimension"]["port"],
            dimension = account["dimension"]["name"],
            character = account["character"],
        )
        
        ergo.start()
        threads.append(ergo)
    
    for ergo in threads:
        ergo.join()
    
    return 0


if __name__ == "__main__":
    status = main(sys.argv[1:])
    sys.exit(status)
